{% extends "base.html" %}
{% block title %}Avisos | Tenebrio Farm{% endblock %}

{% block content %}
<div class="card">
  <h1 style="margin:0 0 10px 0;">AVISOS (Semáforo)</h1>
  <div class="small">
    Generado: {{ now.strftime("%Y-%m-%d %H:%M:%S") }} UTC ·
    PRO amarillo ≥ {{ rules.PRO_YELLOW_DAYS }} días · PRO rojo ≥ {{ rules.PRO_RED_DAYS }} días ·
    Stock: usa umbrales por item (si existen) · fallback bajo ≤ {{ rules.STOCK_YELLOW_KG }} kg
  </div>
</div>

<style>
  .badge { padding: 4px 10px; border-radius: 999px; font-weight: 900; display:inline-block; font-size: 12px; }
  .badge.RED { background:#ffd6d6; border:1px solid #e26a6a; color:#7a0b0b; }
  .badge.YELLOW { background:#fff3c4; border:1px solid #e5c34a; color:#6a4a00; }
  .badge.GREEN { background:#d7f7d7; border:1px solid #7bd77b; color:#0f4f0f; }
  .badge.GRAY { background:#e5e7eb; border:1px solid #cbd5e1; color:#111827; }
  .scope { font-weight: 900; font-size: 12px; padding: 2px 8px; border-radius: 8px; background:#eef2ff; display:inline-block; }
</style>

<div class="card" style="margin-top:12px;">
  {% if alerts|length == 0 %}
    <div class="ok msg">✅ No hay avisos (todo en verde).</div>
  {% else %}
    <table>
      <thead>
        <tr>
          <th style="width:120px;">Semáforo</th>
          <th style="width:100px;">Tipo</th>
          <th style="width:220px;">Elemento</th>
          <th>Mensaje</th>
        </tr>
      </thead>
      <tbody>
        {% for a in alerts %}
        <tr>
          <td><span class="badge {{a.level}}">{{a.level}}</span></td>
          <td><span class="scope">{{a.scope}}</span></td>
          <td>
            <a href="{{a.link}}">{{a.code}}</a>
          </td>
          <td>{{a.message}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>
{% endblock %}
